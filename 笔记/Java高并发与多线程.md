#### b站 马士兵

#### Java多线程与高并发 课程



#### 8/3

1.首先是理解重量级锁和轻量级锁：

什么是重量级？就是需要惊动os。（现在的操作系统不允许用户态直接修改内存等内容。）

2.CAS: compare and swap

如果不想经过os操作，想在用户态解决问题的话，可以用CAS。

CAS怎么保证原子性呢？ 底层实现：lock cmpxchg  (lock指令在执行后面指令的时候锁定一个北桥信号)

3.markword:记录锁信息、GC、identity hashcode。

4.到底什么是给对象加锁？

一加锁，对象的markword就会改变。

5.为什么轻量级锁还会升级为重量级锁呢？

因为如果等待线程太多了的话，一直在那里自旋，会消耗过多cpu资源，此时还不如重量级锁好。重量级锁里面有等待队列，不需要消耗cpu。

6.偏向锁是4秒后才启动。如果明确的知道有多个线程会竞争，那就没必要用偏向锁。