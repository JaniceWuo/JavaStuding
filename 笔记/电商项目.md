#### 技术特点

高并发（分布式、静态化技术、缓存技术、异步并发、池化、队列）

高可用（集群、负载均衡、限流、降级、熔断）

数据量大

业务复杂

数据安全

技术新



#### 技术选型

##### 前端：

HTML CSS  js   jquery

vuejs2.0

vue脚手架：vue-cli

前端构建工具：WebPack

前端安装包：npm

ajax框架：axios

基于vue的富文本框架：quill-editor

##### 后端：

SpringMVC  SringBoot MyBatis

Spring Cloud最新版

Redis

RabbitMQ-3.4

Elasticsearch

nginx

FastDFS 分布式文件系统（统一管理图片资源）

Mycat

Thymeleaf

mysql



#### leyou商城开发

踩坑：

不知道是不是eureka版本问题，根据springboot的版本我只能用eureka2.0.0。然后代码有变动：

```java
@SpringBootApplication(exclude={DataSourceAutoConfiguration.class, HibernateJpaAutoConfiguration.class})
```

如果只写了@SpringBootApplication，程序无法启动



#### 前端开发

##### Nginx

反向代理器

利用反向代理，就可以解决端口问题

![](E:\github\JavaStuding\笔记\nginx.PNG)

将域名设置为manage.leyou.com，其实就是把127.0.0.1反向代理到这个地址。

除了ngnix的文件中的server_name要修改外，还要修改C:\Windows\System32\drivers\etc下的hosts文件，需要管理员权限（命令行管理员输入notepad打开该文件在末尾添加127.0.0.1 manage.leyou.com即可)



#### 7/2

如果在一个地方使用了@MapperScan(....)去扫描mapper包，那就不需要在每个mapper上面加@Mapper了。

`SpringBoot整合MyBatis有一个通用mapper，需要在pom中引入mapper-spring-boot-starter依赖，就可以通过extends Mapper来使用里面自带的各种增删改查方法。`

关于通过notepad的管理员权限来修改hosts文件，第一天可以，第二天就保存失败了。解决方案是把写入权限给勾上。然后在hosts文件末尾加上127.0.0.1 api.leyou.com，这样就能获取到各种物品的json格式了。现在还有跨域问题未解决（因为从manage.leyou.com到api.leyou.com是跨域）。

解决跨域：

CORS 规范化的跨域请求方案 安全可靠

在gateway网关下面写个cors类：

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;

@Configuration
public class LeyouCorsConfiguration {
    @Bean
    public CorsFilter corsFilter(){
        CorsConfiguration configuration = new CorsConfiguration();
        //允许跨域的域名 如果要携带cookie 不能写*
        configuration.addAllowedOrigin("http://manage.leyou.com");
        configuration.setAllowCredentials(true);//允许携带cookie
        configuration.addAllowedMethod("*");
        configuration.addAllowedHeader("*");

        UrlBasedCorsConfigurationSource configurationSource = new UrlBasedCorsConfigurationSource();
        configurationSource.registerCorsConfiguration("/**",configuration);
        return new CorsFilter(configurationSource);
    }
}

```

关于分页：

不像之前那样自己写分页算法，而是直接调用PageHelper中的方法，就可以完成页面转换。

在前端的http.js里面写了Vue.prototype.$http = axios; 这样其他文件就可以用$http

在新增品牌时，插入中文数据在数据库中全变成了?，但是数据库本身是utf8，并且直接命令行进行插入数据能正确显示。查找原因发现，连接数据库的url要改为：`jdbc:mysql://localhost:3306/leyou?characterEncoding=utf8`。



#### 7/3

##### 文件上传，这里特指图片上传。

nginx中的配置有变化，location不再是一个http路径，而是本地文件夹路径，好像是上传之后会把该图片存到这个路径下，这个路径和代码里的：file.transferTo( new File("E:\\" + originalFilename) )要一致。然后通过image.leyou.com/图片名 访问到的是这个路径下的图片。

#### 绕过网关进行图片上传

要在nginx里面配置

由于上传图片的请求路径是：http://api.leyou.com/api/upload/image，但是真实路径是localhost:8082/upload/image,所以要重写路径。

```conf
    server {
        listen       80;
        server_name  api.leyou.com;

        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;


        location /api/upload {
        	proxy_pass http://127.0.0.1:8082;

            rewrite "^/api/(.*)$" /$1 break;
        }

        location / {
            proxy_pass http://127.0.0.1:10010;

            root   html;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }
```



#### FastDFS

是一个分布式文件系统 功能丰富：

- 文件存储

- 文件同步

- 文件访问

- 存取负载均衡

- 在线扩容

FastDFS两个主要的角色：Tracker Server和Storage Server。

上传：client-->tracker-->storage的地址信息-->storage上传图片-->client(图片id)

##### 安装：

在阿里云服务器上配置，启动FastDFS:  

/etc/init.d/fdfs_trackerd start

/etc/init.d/fdfs_storaged start

启动nginx:  /usr/local/nginx/sbin/nginx

/usr/local/nginx/sbin/nginx -s reload 重启nginx

netstat -unltp | grep fdfs查看要有两个



centos:

sudo yum install -y pcre pcre-devel

sudo yum install -y zlib zlib-devel

sudo yum install -y openssl openssl-devel



查看nginx和fastdfs:

ps -ef | grep fdfs

ps -ef | grep nginx



nginx.conf里面要加上user root;

还有什么tracker.conf  client.conf   mod_fastdfs.conf 里面的http_server_port全改为80端口



#### 7/6

SPU:Standard Product Unit(标准产品单位)是一个抽象的商品集概念，

SKU:Stock Keeping Unit(库存单位) SPU商品集因具体特性不同而细分的每个商品

表的设计：

tb_spec_param里面有cid，是为了直接和tb_category进行关联

有generic:是否是通用字段 若为true 去spu获取参数值  若为false  去sku获取参数值

![image-20200706223953731](C:\Users\zhuowei\AppData\Roaming\Typora\typora-user-images\image-20200706223953731.png)



规格参数页面

因为numeric在MySql里面是关键字，所以要加上@Column(name = "`numeric`")











